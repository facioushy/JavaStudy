# 项目

SpringBoot+Mybatisplus

mysql

redis

rabbitmq

## 功能

### 1. 注册

进入注册界面后，首先请求验证码图片，后端把图片的计算结果存入redis。key是公式，value是结果，返回计算公式和图片给前端。

前端发送注册信息，包括用户名，密码，验证码，计算公式，计算结果，前端自定的盐值。

后端首先验证验证码的正确与否：找到相应的key，验证成功后删除key，失败返回错误。

通过主键唯一来判断是否重复注册。

密码通过MD5加密：前端会自定一个盐值放在请求中，首先用后端盐值对密码进行一次修饰后，用MD5加密，再对加密后的密码通过前端盐值再进行一个MD5加密，就是二次MD5+salt加密，返回一个加密后的密码存入数据库。前端的salt会保存到数据库

之后判断是否注册成功，失败则返回。

成功会生成一个token，token是一个随机生成的uuid，设置有效期，存入cookie，跳转到商品列表。

注册功能实现完成

### 2. 登录

前端发送账号密码，后端从库里取出对应账号的信息，判断是否为空，空则报错。通过同样的方式对前端传来的密码进行加密，判断前端的密码和库里存的密码是否相同，相同则登录成功。登录成功后生成token，加入到cookie中。

登录功能实现完成

### 3. 秒杀

从2界面切换到商品列表界面，选择商品后进入秒杀界面（秒杀未开始或已结束按钮置灰，不生产验证码），验证用户是否携带合法token，不合法直接返回报错信息，合法则以用户名+商品ID为key，value为验证码结果保存到redis中，同时返回图片。

按下下单按钮后，后端首先验证token的合法性，再判断验证码是否正确。key结构是username+goodsId。

生成一个随机的path：uuid+盐值通过MD5加密，redis的key为username_goodsId结构，value为加密后的形式，返回给前端。

前端再携带这个path，goodsId发送请求下单，验证user合法性

验证path合法性：判断传入的和从redis中取出来的是否相同

再判断是否秒杀到，可能存在的情况：

1. 重复秒杀，即再库中已存在秒杀订单
2. 商品秒杀完，秒杀结束：每次下单前都会预见库存，即从redis中取出库存值，减去1后判断是否小于0，小于0则说明秒杀结束
3. 秒杀下单：以user和goodsId的结构发送秒杀订单到mq

mq消费者抢订单，抢到就下单成功，否则不断请求去获取是否创建订单成功

成功：跳转到付钱界面

失败：判断是否秒杀结束，未结束继续请求，结束结束

最后到结果页，判断订单是否存在。
